@page "/"

<PageTitle>User Registration</PageTitle>

<h3>User Registration</h3>


<EditForm Model="@user" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="firstName">First Name</label>
        <InputText id="firstName" class="form-control" @bind-Value="user.FirstName" />
    </div>

    <div class="form-group">
        <label for="lastName">Last Name</label>
        <InputText id="lastName" class="form-control" @bind-Value="user.LastName" />
    </div>

    <div class="form-group">
        <label for="email">Email</label>
        <InputText id="email" class="form-control" @bind-Value="user.Email" />
    </div>

    <h4>Select the profile(s) you want to fill out</h4>
    <InputRadioGroup @bind-Value="profileType" Name="ProfileType">
        <div class="form-check">
            <InputRadio id="isMentor" class="form-check-input" Value="ProfileType.Mentor" />
            <label class="form-check-label" for="isMentor">
                Mentor
            </label>
        </div>
        <div class="form-check">
            <InputRadio id="isMentee" class="form-check-input" Value="ProfileType.Mentee" />
            <label class="form-check-label" for="isMentee">
                Mentee
            </label>
        </div>
        <div class="form-check">
            <InputRadio id="isBoth" class="form-check-input" Value="ProfileType.Both" />
            <label class="form-check-label" for="isBoth">
                Both (Mentor and Mentee)
            </label>
        </div>
    </InputRadioGroup>

    @if (profileType == ProfileType.Mentor || profileType == ProfileType.Both)
    {
        <MentorForm MentorModel="@mentorModel" />
    }

    @if (profileType == ProfileType.Mentee || profileType == ProfileType.Both)
    {
        <MenteeForm MenteeModel="@menteeModel" />
    }    

    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@inject NavigationManager Nav

@code {
    private Users.User user = new Users.User(string.Empty, string.Empty, string.Empty);
    private MentorsProfile.Mentor mentorModel = new MentorsProfile.Mentor(string.Empty, new List<string>(), new List<string>());
    private MenteesProfile.Mentee menteeModel = new MenteesProfile.Mentee(string.Empty, new List<string>(), new List<string>());

    public enum ProfileType
    {
        Mentor,
        Mentee,
        Both
    }

    private ProfileType profileType;

    private bool isMentor => profileType == ProfileType.Mentor || profileType == ProfileType.Both;
    private bool isMentee => profileType == ProfileType.Mentee || profileType == ProfileType.Both;

    private async Task HandleValidSubmit()
    {
        await Api.Users.Create(user.FirstName, user.LastName, user.Email);

        if (profileType == ProfileType.Mentor || profileType == ProfileType.Both)
        {
            mentorModel.UserId = user.Id;
            await Api.Mentors.Create(mentorModel.UserId, mentorModel.Expertise, mentorModel.AvailableTimes);
        }

        if (profileType == ProfileType.Mentee || profileType == ProfileType.Both)
        {
            menteeModel.UserId = user.Id;
            await Api.Mentees.Create(menteeModel.UserId, menteeModel.Interests, menteeModel.PreferredTimes);
        }
        
        Nav.NavigateTo("/mentors");
    }
}


